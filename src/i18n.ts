import i18n from "i18next";
import { initReactI18next } from "react-i18next";
import { getLanguagePreference } from "@/cache/medicalTermsCache";

async function getInitialLanguage() {
  // Try to get from IndexedDB, fallback to localStorage, then default
  let lang = null;
  try {
    lang = await getLanguagePreference();
  } catch (e) {
    // ignore
  }
  if (!lang && typeof window !== "undefined") {
    lang = localStorage.getItem("language") || undefined;
  }
  return lang || "ru";
}

const i18nInit = async () => {
  const initialLang = await getInitialLanguage();
  i18n.use(initReactI18next).init({
    resources: {
      en: {
        translation: {
          home_title: "Learn Hebrew Easily",
          home_description: "Expand your vocabulary, practice expressions, and have fun learning Hebrew",
          view_dictionary: "Open Dictionary",
          start_learning: "Start Learning",
          home_what_can_do: "What can you do on the site?",
          home_learn_words: "Learn useful Hebrew words with translations into Russian and English",
          home_practice_games: "Practice Hebrew through games and quizzes",
          home_choose_method: "Choose your way to learn:",
          feature_dictionary: "Dictionary",
          feature_dictionary_desc: "Browse all words and categories",
          feature_quiz: "Quiz",
          feature_quiz_desc: "Check your knowledge",
          feature_game: "Games",
          feature_game_desc: "Fun and interactive learning",
          dictionary_title: "Hebrew Dictionary",
          dictionary_description: "Practice Hebrew words with translations in English and Russian",
          search_placeholder: "Search words...",
          all_categories: "All Categories",
          export_favorites: "Export Favorites",
          loading: "Loading words...",
          no_words: "No words found",
          favorites: "Favorites",
          nav_home: "Home",
          nav_quiz: "Quiz",
          nav_soap_game: "SOAP Practice",
          nav_matching_game: "Game",
          nav_dictionary: "Dictionary",
          nav_contactUs: "ContactUs",
          nav_learning: "Learning",
          matching_title: "64-Word Matching Game",
          matching_description: "Improve your Hebrew with a 3-minute matching challenge of 64 selected words",
          matching_rules_title: "Game Rules",
          matching_rule_2: "â±ï¸ Complete as many as possible in 3 minutes",
          matching_rule_3: "ğŸ”„ New word pairs appear after each match",
          matching_start: "Start Challenge",
          quiz_header: "What does this Hebrew term mean?",
          quiz_counter: "Question",
          quizsettings: "Quiz Settings",
          quizsettings_description: "Customize your learning experience",
          quizsettings_language: "Category Filter",
          quiz_correct_answer: "Correct Answer",
          quiz_incorrect_answer: "Incorrect Answer",
          quiz_topics: "Focus on specific medical topics",
          quiz_preferred_language: "Choose your preferred translation language",
          continue_learning: "Continue Learning",
          play_game: "Play Game",
          explore_quiz: "Try Quiz",
          get_started_free: "Get Started Free",
        },
      },
      he: {
        translation: {
          home_title: "×œ×•××“×™× ×¢×‘×¨×™×ª ×‘×§×œ×•×ª",
          home_description: "×”×¨×—×™×‘×• ××ª ××•×¦×¨ ×”××™×œ×™× ×©×œ×›×, ×ª×¨×’×œ×• ×‘×™×˜×•×™×™×, ×•×ª×™×”× ×• ××œ×™××•×“ ×¢×‘×¨×™×ª",
          view_dictionary: "×¤×ª×— ××™×œ×•×Ÿ",
          start_learning: "×”×ª×—×œ ×œ×œ××•×“",
          home_what_can_do: "××” ××¤×©×¨ ×œ×¢×©×•×ª ×‘××ª×¨?",
          home_learn_words: "×œ×œ××•×“ ××™×œ×™× ×©×™××•×©×™×•×ª ×‘×¢×‘×¨×™×ª ×¢× ×ª×¨×’×•× ×œ×¨×•×¡×™×ª ×•×× ×’×œ×™×ª",
          home_practice_games: "×œ×ª×¨×’×œ ×¢×‘×¨×™×ª ×“×¨×š ××©×—×§×™× ×•×—×™×“×•× ×™×",
          home_choose_method: "×‘×—×¨×• ××ª ×“×¨×š ×”×œ××™×“×” ×©×œ×›×:",
          feature_dictionary: "××™×œ×•×Ÿ",
          feature_dictionary_desc: "×¢×™×•×Ÿ ×‘×›×œ ×”××™×œ×™× ×•×”×§×˜×’×•×¨×™×•×ª",
          feature_quiz: "×—×™×“×•×Ÿ",
          feature_quiz_desc: "×‘×“×§×• ××ª ×”×™×“×¢ ×©×œ×›×",
          feature_game: "××©×—×§×™×",
          feature_game_desc: "×œ××™×“×” ××”× ×” ×•××™× ×˜×¨××§×˜×™×‘×™×ª",
          dictionary_title: "××™×œ×•×Ÿ ×¢×‘×¨×™×ª",
          dictionary_description: "×ª×¨×’×œ×• ××™×œ×™× ×‘×¢×‘×¨×™×ª ×¢× ×ª×¨×’×•× ×œ×× ×’×œ×™×ª ×•×¨×•×¡×™×ª",
          search_placeholder: "×—×¤×© ××™×œ×™×...",
          all_categories: "×›×œ ×”×§×˜×’×•×¨×™×•×ª",
          export_favorites: "×™×™×¦×•× ××•×¢×“×¤×™×",
          loading: "×˜×•×¢×Ÿ ××™×œ×™×...",
          no_words: "×œ× × ××¦××• ××™×œ×™×",
          favorites: "××•×¢×“×¤×™×",
          nav_home: "×‘×™×ª",
          nav_quiz: "×—×™×“×•×Ÿ",
          nav_soap_game: "×ª×¨×’×•×œ SOAP",
          nav_matching_game: "××©×—×§",
          nav_dictionary: "××™×œ×•×Ÿ",
          nav_contactUs: "×¦×¨×• ×§×©×¨",
          nav_learning: "×œ××™×“×”",
          matching_title: "××©×—×§ ×”×ª×××ª 64 ××™×œ×™×",
          matching_description: "×©×¤×¨×• ××ª ×”×¢×‘×¨×™×ª ×©×œ×›× ×¢× ××ª×’×¨ ×”×ª×××” ×©×œ 3 ×“×§×•×ª ×”×›×•×œ×œ 64 ××™×œ×™× × ×‘×—×¨×•×ª",
          matching_rules_title: "×›×œ×œ×™ ×”××©×—×§",
          matching_rule_2: "â±ï¸ ×”×©×œ×™××• ×›××” ×©×™×•×ª×¨ ×‘-3 ×“×§×•×ª",
          matching_rule_3: "ğŸ”„ ×–×•×’×•×ª ××™×œ×™× ×—×“×©×™× ××•×¤×™×¢×™× ××—×¨×™ ×›×œ ×”×ª×××”",
          matching_start: "×”×ª×—×œ ××ª ×”××ª×’×¨",
          quiz_header: "××” ×”××©××¢×•×ª ×©×œ ××•× ×— ×¢×‘×¨×™ ×–×”?",
          quiz_counter: "×©××œ×”",
          quizsettings: "×”×’×“×¨×•×ª ×—×™×“×•×Ÿ",
          quizsettings_description: "×”×ª××™××• ××ª ×—×•×•×™×™×ª ×”×œ××™×“×” ×©×œ×›×",
          quizsettings_language: "×¡×™× ×•×Ÿ ×§×˜×’×•×¨×™×•×ª",
          quiz_correct_answer: "×ª×©×•×‘×” × ×›×•× ×”",
          quiz_incorrect_answer: "×ª×©×•×‘×” ×©×’×•×™×”",
          quiz_topics: "×”×ª××§×“×•×ª ×‘× ×•×©××™× ×¨×¤×•××™×™× ×¡×¤×¦×™×¤×™×™×",
          quiz_preferred_language: "×‘×—×¨×• ××ª ×©×¤×ª ×”×ª×¨×’×•× ×”××•×¢×“×¤×ª ×¢×œ×™×›×",
          continue_learning: "×”××©×š ×œ×œ××•×“",
          play_game: "×©×—×§ ××©×—×§",
          explore_quiz: "× ×¡×” ×—×™×“×•×Ÿ",
          get_started_free: "×”×ª×—×œ ×‘×—×™× ×",
        },
      },
      ru: {
        translation: {
          home_title: "Ğ£Ñ‡Ğ¸Ñ‚Ğµ Ğ¸Ğ²Ñ€Ğ¸Ñ‚ Ğ»ĞµĞ³ĞºĞ¾",
          home_description: "ĞŸĞ¾Ğ¿Ğ¾Ğ»Ğ½ÑĞ¹Ñ‚Ğµ ÑĞ»Ğ¾Ğ²Ğ°Ñ€Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ğ°Ñ, Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ¸ ÑƒÑ‡Ğ¸Ñ‚Ğµ Ğ¸Ğ²Ñ€Ğ¸Ñ‚ Ñ ÑƒĞ´Ğ¾Ğ²Ğ¾Ğ»ÑŒÑÑ‚Ğ²Ğ¸ĞµĞ¼",
          view_dictionary: "ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ",
          start_learning: "ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ",
          home_what_can_do: "Ğ§Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ½Ğ° ÑĞ°Ğ¹Ñ‚Ğµ?",
          home_learn_words: "Ğ£Ñ‡Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ° Ğ½Ğ° Ğ¸Ğ²Ñ€Ğ¸Ñ‚Ğµ Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ¼ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¸Ğ¹ Ğ¸ Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸Ğ¹",
          home_practice_games: "ĞŸÑ€Ğ°ĞºÑ‚Ğ¸ĞºÑƒĞ¹Ñ‚Ğµ Ğ¸Ğ²Ñ€Ğ¸Ñ‚ Ñ‡ĞµÑ€ĞµĞ· Ğ¸Ğ³Ñ€Ñ‹ Ğ¸ Ğ²Ğ¸ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ñ‹",
          home_choose_method: "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ¿Ğ¾ÑĞ¾Ğ± Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ:",
          feature_dictionary: "Ğ¡Ğ»Ğ¾Ğ²Ğ°Ñ€ÑŒ",
          feature_dictionary_desc: "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ²ÑĞµÑ… ÑĞ»Ğ¾Ğ² Ğ¸ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹",
          feature_quiz: "Ğ’Ğ¸ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ°",
          feature_quiz_desc: "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ÑĞ²Ğ¾Ğ¸ Ğ·Ğ½Ğ°Ğ½Ğ¸Ñ",
          feature_game: "Ğ˜Ğ³Ñ€Ñ‹",
          feature_game_desc: "Ğ’ĞµÑÑ‘Ğ»Ğ¾Ğµ Ğ¸ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğµ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ",
          dictionary_title: "Ğ¡Ğ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ğ¸Ğ²Ñ€Ğ¸Ñ‚Ğ°",
          dictionary_description: "ĞŸÑ€Ğ°ĞºÑ‚Ğ¸ĞºÑƒĞ¹Ñ‚Ğµ ÑĞ»Ğ¾Ğ²Ğ° Ğ½Ğ° Ğ¸Ğ²Ñ€Ğ¸Ñ‚Ğµ Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ¼ Ğ½Ğ° Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸Ğ¹ Ğ¸ Ñ€ÑƒÑÑĞºĞ¸Ğ¹",
          search_placeholder: "ĞŸĞ¾Ğ¸ÑĞº ÑĞ»Ğ¾Ğ²...",
          all_categories: "Ğ’ÑĞµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸",
          export_favorites: "Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾",
          loading: "Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ÑĞ»Ğ¾Ğ²...",
          no_words: "Ğ¡Ğ»Ğ¾Ğ²Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹.",
          favorites: "Ğ˜Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ",
          nav_home: "Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ",
          nav_quiz: "Ğ’Ğ¸ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ°",
          nav_soap_game: "ĞŸÑ€Ğ°ĞºÑ‚Ğ¸ĞºĞ° SOAP",
          nav_matching_game: "Ğ˜Ğ³Ñ€Ğ°",
          nav_dictionary: "Ğ¡Ğ»Ğ¾Ğ²Ğ°Ñ€ÑŒ",
          nav_contactUs: "Ğ¡Ğ²ÑĞ·Ğ°Ñ‚ÑŒÑÑ Ñ Ğ½Ğ°Ğ¼Ğ¸",
          nav_learning: "ĞĞ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ",
          matching_title: "Ğ˜Ğ³Ñ€Ğ° Ğ½Ğ° ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ 64 ÑĞ»Ğ¾Ğ²",
          matching_description: "Ğ£Ğ»ÑƒÑ‡ÑˆĞ°Ğ¹Ñ‚Ğµ Ğ¸Ğ²Ñ€Ğ¸Ñ‚ Ñ 3-Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ½Ñ‹Ğ¼ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ½Ğ° ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ 64 Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ñ… ÑĞ»Ğ¾Ğ².",
          matching_rules_title: "ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ¸Ğ³Ñ€Ñ‹",
          matching_rule_2: "â±ï¸ Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ ĞºĞ°Ğº Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ·Ğ° 3 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹",
          matching_rule_3: "ğŸ”„ ĞĞ¾Ğ²Ñ‹Ğµ Ğ¿Ğ°Ñ€Ñ‹ ÑĞ»Ğ¾Ğ² Ğ¿Ğ¾ÑĞ²Ğ»ÑÑÑ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¿Ğ°Ñ€Ñ‹",
          matching_start: "ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ",
          quiz_header: "ĞšĞ°ĞºĞ¾Ğ²Ğ¾ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¸Ğ²Ñ€Ğ¸Ñ‚ÑĞºĞ¾Ğ³Ğ¾ Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°?",
          quiz_counter: "Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ",
          quizsettings: "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ²Ğ¸ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ñ‹",
          quizsettings_description: "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹Ñ‚Ğµ ÑĞ²Ğ¾Ğ¹ Ğ¾Ğ¿Ñ‹Ñ‚ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ",
          quizsettings_language: "Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹",
          quiz_correct_answer: "ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚",
          quiz_incorrect_answer: "ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚",
          quiz_topics: "Ğ¡Ğ¾ÑÑ€ĞµĞ´Ğ¾Ñ‚Ğ¾Ñ‡ÑŒÑ‚ĞµÑÑŒ Ğ½Ğ° Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½Ğ½Ñ‹Ñ… Ğ¼ĞµĞ´Ğ¸Ñ†Ğ¸Ğ½ÑĞºĞ¸Ñ… Ñ‚ĞµĞ¼Ğ°Ñ…",
          quiz_preferred_language: "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¿Ñ€ĞµĞ´Ğ¿Ğ¾Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°",
          continue_learning: "ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ",
          play_game: "Ğ˜Ğ³Ñ€Ğ°Ñ‚ÑŒ Ğ² Ğ¸Ğ³Ñ€Ñƒ",
          explore_quiz: "ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²Ğ¸ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ñƒ",
          get_started_free: "ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾",
        },
      },
    },
    lng: initialLang, // Use preferred or default
    fallbackLng: "en",
    interpolation: {
      escapeValue: false,
    },
  });
};

i18nInit();

export default i18n;